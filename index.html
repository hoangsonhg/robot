<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·∫©n ƒêo√°n Robot CND</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #000; color: #fff; padding: 20px; }
        .error-box { background: #450a0a; border: 2px solid #ef4444; color: #fecaca; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: left; font-family: monospace; font-size: 13px; display: none; }
        #startBtn { padding: 20px; background: #22c55e; color: white; border: none; border-radius: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h2>ü§ñ KI·ªÇM TRA K·∫æT N·ªêI CND</h2>
    <button id="startBtn">B·∫¨T MIC ƒê·ªÇ TEST</button>
    
    <div id="status" style="margin: 20px; color: #38bdf8;">ƒêang ch·ªù anh b·∫•m n√∫t...</div>
    <div id="errorBox" class="error-box"></div>
    <div id="log" style="text-align: left; padding: 10px; background: #111; height: 100px; overflow: auto; border: 1px solid #333;"></div>

    <script>
        // API KEY C·ª¶A ANH S∆†N
        const API_KEY = "AIzaSyCs8gITrFcSUHYe_6KeJnWrcQd0tBdMgwo";
        const MODEL = "gemini-1.5-flash"; // D√πng b·∫£n Flash ƒë·ªÉ ƒë·∫£m b·∫£o ·ªïn ƒë·ªãnh 100%

        const startBtn = document.getElementById('startBtn');
        const status = document.getElementById('status');
        const errorBox = document.getElementById('errorBox');
        const log = document.getElementById('log');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recog = new SpeechRecognition();
        recog.lang = 'vi-VN';

        startBtn.onclick = () => { recog.start(); startBtn.style.display = 'none'; };

        recog.onresult = async (event) => {
            const query = event.results[0][0].transcript;
            log.innerHTML = `<div>Anh h·ªèi: ${query}</div>` + log.innerHTML;
            status.innerText = "‚è≥ ƒêang g·ª≠i d·ªØ li·ªáu sang Google...";
            errorBox.style.display = "none";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "B·∫°n l√† l·ªÖ t√¢n CND. Tr·∫£ l·ªùi c·ª±c ng·∫Øn: " + query }] }] })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    errorBox.style.display = "block";
                    errorBox.innerText = "L·ªñI T·ª™ GOOGLE: " + JSON.stringify(errorData, null, 2);
                    status.innerText = "‚ùå Th·∫•t b·∫°i!";
                } else {
                    const data = await response.json();
                    const reply = data.candidates[0].content.parts[0].text;
                    log.innerHTML = `<div style="color:#22c55e">Robot: ${reply}</div>` + log.innerHTML;
                    status.innerText = "‚úÖ Th√†nh c√¥ng! H√£y n√≥i ti·∫øp.";
                    const msg = new SpeechSynthesisUtterance(reply);
                    msg.lang = 'vi-VN';
                    window.speechSynthesis.speak(msg);
                }
            } catch (err) {
                errorBox.style.display = "block";
                errorBox.innerText = "L·ªñI M·∫†NG: Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi Google. Ki·ªÉm tra Wifi nh√† h√†ng!";
            }
        };

        recog.onend = () => { setTimeout(() => recog.start(), 1000); };
    </script>
</body>
</html>
